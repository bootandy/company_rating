<!DOCTYPE HTML>
<html>
<head>
    <script src="kinetic.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
    <script src="jquery.json-2.4.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script src="detectBrowser.js" type="text/javascript"></script>
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div id="text_chart"> Drag the boxes onto chart</div>
    <div id="chart">
      <div id="container"></div>
      <div id="averagecontainer"></div>
      <div id="nondraggable"></div>
      <div id="userplacement"></div>

    </div>
    <a href="#" title="By placing the product in the chart, you're scoring it between 0% and
                        100% on both dimensions. Here we show you how you differ from the
                        average for each product: read it as, say 'I see it as 10% simpler,
                        and 20% less powerful, than the average'." id="tool_tip">i</a>

    <div id="mobile-device">

        <p>The interactive chart is currently not supported on mobiles or tablets, please return to the blog when you are using a desktop/laptop. In the meantime why not read our thoughts on each of the products?</p>
    
    </div>


    <div id="table_image">
     <img src="img/table.png" alt="table"/>
     <img src ="img/table_trend.png" alt="trend" id="trend"/>
    </div>


    <div id="average_showhide">
            <a href="#" id="myonoffswitch">hide averages</a>
    </div>


    <div id="your_showhide">
            <a href="#" id="onoffswitch-user">hide my input</a>
    </div>

    <button class='save_button'>Submit</button>

    <div id="average_power_simple">
       Overall, you scored these products <span id="average_simple"> X% </span> simple and <span id="average_powerful"> X% </span> powerful
    </div>

<div class="showpercent">
    <div id= "showpercentage_fb">
        <div id="1" >
            <p id="fb-simple" class="simple"></p>
            <p id="fb-power" class="power"></p>
        </div>
    </div>

    <div id="showpercentage_tw">
        <div id="2" class="tw_percent">
            <p id="tw-simple" class="simple"></p>
            <p id="tw-power" class="power"></p>
        </div>
    </div>
    
    <div id="showpercentage_gm">    
        <div id="3" class="gm_percent">
            <p id="gm-simple" class="simple"></p>
            <p id="gm-power" class="power"></p>
        </div>
    </div>
    
    <div id="showpercentage_db">    
        <div id="4" class="db_percent">
            <p id="db-simple" class="simple"></p>
            <p id="db-power" class="power"></p>
        </div>
    </div>
    
    <div id="showpercentage_az">    
        <div id="5" class="az_percent">
            <p id="az-simple" class="simple"></p>
            <p id="az-power" class="power"></p>
        </div>
    </div>
    
    <div id="showpercentage_eb">    
        <div id="6" class="eb_percent">
            <p id="eb-simple" class="simple"></p>
            <p id="eb-power" class="power"></p>
        </div>
    </div>
</div>

    <div class="greyline"></div>

    <div id="thoughts-blog-simple_powerful">

        <div class="Introduction-thoughts-simple_powerful">
            <p id="share_input">Thanks for your input! We're looking forward to posting the results, once we get a good number of them. Help us with that by sharing.</p>

            <p> Meanwhile, here are some quick notes about my opinions on those 6 products. This will also show how deeply personal perceptions are on this topic, once you carefully think about it: </p>
        </div>

        <div class="facebook">
            <div class="image-thoughts"><img src="img/fb-nest.png" alt="fb-nest" /></div>
            <div class="text-thoughts"> 
            <p><span class="thoughts-title">Facebook:</span> one may now take it for granted, but it is rather powerful: you can do anything from photo-sharing to discussions to stalking to messaging to groups, fan pages, etc. The main feature I expect but is missing is better content search.<br/><br/> Is it simple? I think it is fiendishly complex (who sees what, why do I [not] see what I [don't] see, what is happening that I am missing). However, it can lead its users into what soon become ingrained, comfortable yet very personal habits.<br/><br/> It's a maze, but it lets you find your own cozy niche. Verdict: <span class="thoughts-italics"> 80% powerful, 30% simple </span> </p>
        </div>
        
        </div>

        <div class="twitter">
            <div class="image-thoughts"><img src="img/tw-bottle.png" alt="tw-bottle" /></div>
            <div class="text-thoughts"> 
           <p><span class="thoughts-title">Twitter:</span> it is powerful in scope, but not in features: it can be used for different purposes, but there are only really at most a dozen of actions on it. <br/><br/>It is supposed to be simple. But in practice, there are significant barriers to engagement, which may be why many people complain that they don't get Twitter. If you ever get it, and if it responds to a need you have, beware as it can become addictive. <br/><br/>A bit like whisky perhaps? Verdict: <span class="thoughts-italics"> 30% powerful, 50% simple </span> </p>
        </div>
        
        </div>

        <div class="gmail">
            <div class="image-thoughts"><img src="img/gm-dog.png" alt="gm-dog" /></div>
            <div class="text-thoughts"> 
            <p><span class="thoughts-title">Gmail:</span> as an email client, it offers plenty of clever features, from chat, to filters, to labels, to embedded native and external apps, etc. However, some features I'd like are missing, from downloading a list of emails to easily searching filters. <br/><br/>It's quite simple, though it occasionally seems to complicate things by giving you too many choices. <br/><br/>A loyal, clever, slightly over-eager pet. Verdict: <span class="thoughts-italics"> 60% powerful, 70% simple </span> </p>

        </div>
        </div>

        <div class="dropbox">
            <div class="image-thoughts"><img src="img/db-box.png" alt="db-box" /></div>
            <div class="text-thoughts"> 
            <p><span class="thoughts-title">Dropbox:</span> like Twitter, it is perceived as the ultimate simple product. And, well, it is very simple (although not without some quirks). <br/><br/>It isn't powerful, though: it can do essentially one very useful thing, which is why it has been described as a feature, not a product. Evernote seems its diametrical opposite. <br/><br/>Solid like... err... a box? Verdict: <span class="thoughts-italics"> 20% powerful, 90% simple </span> </p>
        </div>
        </div>

        <div class="amazon">
            <div class="image-thoughts"><img src="img/az-gears.png" alt="az-gears" /></div>
            <div class="text-thoughts"> 
            <p><span class="thoughts-title">Amazon:</span> one may forget it, but it is rather feature-rich, with its sophisticated, product-specific filters, its ratings and reviews, and reviews of reviews, its well-known recommendation engine, its offering from a variety of sellers. <br/><br/>It also has a clear purpose, which helps to make it simple. It can feel a little chaotic as you search, and is not the prettiest, but the purchase funnel is very effective. <br/><br/>A well-oiled machine. Verdict: <span class="thoughts-italics"> 70% powerful, 60% simple </span> </p>
        </div>
        </div>

        <div class="ebay">
            <div class="image-thoughts"><img src="img/eb-basket.png" alt="eb-basket" /></div>
            <div class="text-thoughts"> 
            <p><span class="thoughts-title">eBay:</span> I must confess, I am not enough of a user of eBay to have a well-informed opinion about it, so I follow my own pro-tip and I'll leave it out. </p>
        </div>
        </div>

    </div>

    <div class="greyline"></div>

    <div id="email">
        <p>Enter your email address, and we'll send you a download link, when we've compiled all the data</p>
        <script type="text/javascript">
                var submitted = false;
        </script>

        <iframe name="hidden_iframe" id="hidden_iframe"

            style="display:none;" onload="if (submitted)
            {
                window.location = '#';
            }">

        </iframe>

        <form id="email_form" action="https://docs.google.com/spreadsheet/formResponse?formkey=dENQZXRIb0s1T2VEZDdCdzB4NlRtZ0E6MQ&amp;ifq" method="post"
                  target="hidden_iframe" onsubmit="submitted = true;">

            <div class="errorbox-good">
                <input type="text" name="entry.0.single" value="" class="required_mail email" id="entry_0" placeholder="Enter your email address">
                <input type="submit" name="submit" class="submit-button-sidebar " value="">

            </div>

                <input type="hidden" name="pageNumber" value="0">
                <input type="hidden" name="backupCache" value="">

        </form>
    </div>


    <script>
    var total_width = 600;
    var total_height = 500;
    var grid_width = 500;

    var companies = [];
    var stage;
    var stage_average;
    var stage_draggable;
    var stage_menu_on_right;
    var imgObj = new Image();
    var layer_nondraggable = new Kinetic.Layer();

    var company_options = {
        1: ['Facebook', '#3B5998'],
        2: ['Twitter', '#4099FF'],
        3: ['Gmail', '#dd1812'],
        4: ['Dropbox', '#3d4944'],
        5: ['Amazon', '#e47911'],
        6: ['eBay', '#ffcc00'],
    }

    $(document).ready(function() {


        $(function() {
            $("#tool_tip").tooltip();
        });

        if (jQuery.browser.mobile == true){

            $('#mobile-device').show().css({"position": "absolute", "margin-top": "-550px"});
            $('#chart').show().css("margin-top", "50px");
            $('#table_image').show();
            $('#text_chart').hide();
            $('.save_button').hide();
            $('.Introduction-thoughts-simple_powerful').hide();
            $('#thoughts-blog-simple_powerful').show().css("margin-top","0");
            
        }


        $('.save_button').click(function(){
            $(this).data('clicked', true);
            var data = [];
            var c_ids = [];

            //Text Changes when the user clicks on submit
            document.getElementById("text_chart").innerHTML = "Mouseover to highlight. <br/><br/> Below each product the difference between your input and the average";


            $('.save_button').hide();

            //Shows the trend lines when the user clicks on submit
            $('#trend').show();

            //Shows the toggle to display averages on the grid
            $('#average_showhide').show();

            //show email form field
            $('#email').show();

            //show non-draggable div after the user submits
            $('#nondraggable').show();

            $('#your_showhide').show();
            //Shows or Hides the Averages

            //Shows the percentage when the user clicks submit
            $('.showpercent').show();
            
            $('.greyline').show();

            $('#tool_tip').show();

            $('#thoughts-blog-simple_powerful').show();

            //Hides and shows the averages on the grid.
            $( "#myonoffswitch" ).toggle(
                function() {
                    $(this).text('show averages');
                    $('#averagecontainer').fadeTo("fast", 0.2);
                },
                function() {
                    $(this).text('hide averages');
                    $('#averagecontainer').fadeTo("fast", 1.0);
                }
            );
            // $( "#myonoffswitch" ).click(function() {
            //     //$('#averagecontainer').toggle();
            // });
            
            
            //Hides and shows the users placement on the grid.
            $("#onoffswitch-user").toggle(
                //$('#userplacement').toggle();
                function() {
                    $(this).text('show my input');
                    $('#userplacement').fadeTo("fast", 0.2);
                },
                
                function() {
                    $(this).text('hide my input');
                    $('#userplacement').fadeTo("fast", 1.0);
                }
            );

            for (var i = 0; i < companies.length; i++) {
                
                if (companies[i].getX() < grid_width) {
                    data.push( { "x": companies[i].getX(), "y": companies[i].getY(), "c": String(companies[i].getId()) } ); 
                    
                    } else data.push( { "x": grid_width+1, "y": grid_width+1, "c": String(companies[i].getId()) } ); 
                    c_ids.push(String(companies[i].getId()));
                    // console.log(companies[i].getY(), companies[i].getId());

                //}


            }




            // Save these positions
            $.ajax ({
                type: "POST",
                url: '/data/',
                dataType: 'json',
                contentType: "application/json; charset=utf-8",
                data: $.toJSON(data),
            }).done(function(result) {

                // Positions saved. Now load the averages
                $.ajax ({
                    type: "POST",
                    url: '/averages/',
                    dataType: 'json',
                    contentType: "application/json; charset=utf-8",
                    data: $.toJSON(c_ids),
                }).done(function(result2) {
                    display_averages( result2 );
                    calculatepercentages( result2 );
                });

            });

             for(var row in company_options) {


            var c = build_company_group_hoverable(row);
            layer.add(c);
    }


        });

        function display_averages(data) {
            var results = data['result'];
            average_layer.remove();
            average_layer = new Kinetic.Layer();

            // console.log(results);

            for (var i = 0; i < results.length; i++) {
                if (results[i]._id > 0 && results[i]._id < 7) {
                    var c = build_company_group_average(results[i]._id)
                    if (c != null) {
                        c.setX(results[i].avgx);                
                        c.setY(results[i].avgy);
                        average_layer.add(c);

                        // console.log(i);
                        // console.log(results[i]);
                    }

                }
            }
            
            stage_draggable.add(average_layer);
            stage_average.add(average_layer);

        }
        var average_layer = new Kinetic.Layer();

        



        function calculatepercentages(data) {

            var average_data = data['result'];
            var simple_sum = 0;
            var power_sum =0;
            var count_sum = 0; 

            for (var i = 0; i < companies.length; i++) {
                    
                var comp_id = companies[i].getId();
                var x = companies[i].getX();
                var y = companies[i].getY();

                for (var j = 0; j < average_data.length; j++) {
                    
                    var average_id = average_data[j]._id;
                    
                    if (comp_id == average_id) {

                        var average_x = average_data[j].avgx;
                        var average_y = average_data[j].avgy;
                        
                        if (companies[i].getX() < grid_width) {

                            // console.log("x", companies[i].getX()-45, companies[i].getId());
                            // console.log("y",companies[i].getY()+20, companies[i].getId());
                            // console.log("avgx",(average_data[j].avgx)-45, average_data[j]._id);
                            // console.log("avgy",(average_data[j].avgy)+20, average_data[j]._id);


                            var simple = Math.round(((x - average_x)/445)*100);
                            var power = Math.round(((average_y - y)/430)*100);
                            

                            var simple_sum = simple_sum + simple;
                            var power_sum = power_sum + power; 
                            var count_sum = count_sum + 1;


                             

                            $($('#' + comp_id + ' p')[0]).html(simple + '%');
                            $($('#' + comp_id + ' p')[1]).html(power + '%');
                            
                            //var average_simple_calc = Math.round(simple/simple_array.length);
                            //console.log("Simple_normal", simple);
                            //console.log(average_simple_calc);
                            
                        } 
                        else{

                            var power = "n/a";
                            var simple = " ";
                            $($('#' + comp_id + ' p')[0]).html(simple);
                            $($('#' + comp_id + ' p')[1]).html(power);

                        }


                    }
                }
            }

            if (count_sum == 0) {


            document.getElementById("share_input").innerHTML = "You didn't play with the chart. If you wanted to, please refresh the page, drag the boxes in the chart and click submit."
            
            $('#share_input').show();

            }


            if (count_sum == 0 || count_sum < 2) {

                $('#average_power_simple').hide();

                var count_sum = 1;

            } else if (count_sum > 2) {
                $('#average_power_simple').show();

            }

            

            var total_simple_average = Math.round((simple_sum/count_sum));
            var total_power_average = Math.round((power_sum/count_sum));

            document.getElementById("average_simple").innerHTML = total_simple_average+"%";
            document.getElementById("average_powerful").innerHTML = total_power_average+"%";

            console.log(total_simple_average);
            console.log(total_power_average);
            console.log(count_sum);
        }




   //End of document ready
    });
    
    




    function build_company_group_draggable(c_id) {
       // return _build_company_group(c_id * 60, company_options[c_id][0] , company_options[c_id][0], c_id, true, company_options[c_id][1], 1, '');
        var group =  _build_company_group(c_id * 65, company_options[c_id][0] , company_options[c_id][0], c_id, true, company_options[c_id][1], 1, '');

        group.on('mouseover', function() {
            document.body.style.cursor = '';
           
           //Checks if the button had been clicked 
           if ($('.save_button').data('clicked')) {
                _gray_all_the_groups();
           } 

            _restore_color_to_group(group);
        });

        group.on('mouseleave', function() {
            group.getParent().getChildren().each(function(child, n) {
                _restore_color_to_group(child);
            });
        });

        return group;    

    }

    function build_company_group_hoverable(c_id) {
        var group = _build_company_group(c_id * 65, company_options[c_id][0] , company_options[c_id][0], c_id, false, company_options[c_id][1], 1, '');

        
        group.on('mouseover', function() {
            document.body.style.cursor = '';
            _gray_all_the_groups();
            _restore_color_to_group(group);
        });
        group.on('mouseleave', function() {
            group.getParent().getChildren().each(function(child, n) {
                _restore_color_to_group(child);
            });
        });
        return group;
    }


    function build_company_group_average(c_id) {
        
        var group = _build_company_group(0, company_options[c_id][0], company_options[c_id][0] + ' Avg', c_id, false, company_options[c_id][1], 3, 'bold');

        
        group.on('mouseover', function() {
            document.body.style.cursor = '';
            _gray_all_the_groups();
            _restore_color_to_group(group);
        });

        group.on('mouseleave', function() {
            group.getParent().getChildren().each(function(child, n) {
                _restore_color_to_group(child);
            });
        });


        return group;





        // return _build_company_group(0, company_options[c_id][0], 
        //         company_options[c_id][0] + ' Avg', c_id, 
        //         false, 
        //         company_options[c_id][1], 
        //         3, 
        //         'bold');
    }

    function _gray_all_the_groups() {
        stage_menu_on_right.get('.company_logo_text').each(function(child, n) {
            child.setAttr('fill', '#CCC');
        });
        stage_menu_on_right.get('.company_logo_border').each(function(child, n) {
            child.setAttr('stroke', '#CCC');
        });
        stage_draggable.get('.company_logo_text').each(function(child, n) {
            //child.setAttr('fill', '#CCC');
            child.setAttr('visible', false);

        });
        stage_draggable.get('.company_logo_border').each(function(child, n) {
            //child.setAttr('stroke', '#CCC');
            child.setAttr('visible', false);
        });

        stage_average.get('.company_logo_text').each(function(child, n) {
            //child.setAttr('fill', '#CCC');
            child.setAttr('visible', false);
        });
        stage_average.get('.company_logo_border').each(function(child, n) {
            //child.setAttr('stroke', '#CCC');
            child.setAttr('visible', false);
        });
    }

    function _restore_color_to_group(group) {
        var real_color = group.getAttr('real_color');
        var clazz = group.getAttr('name');

        group.get('.company_logo_text').each(function(child, n) {
            child.setAttr('fill', real_color);
            child.setAttr('visible', true);

        });
        group.get('.company_logo_border').each(function(child, n) {
            child.setAttr('stroke', real_color);
            child.setAttr('visible', true);

        });

        if (stage_draggable.get('.' + clazz)[0]) {
            stage_draggable.get('.' + clazz)[0].get('.company_logo_text').each(function(child, n) {
                child.setAttr('fill', real_color);
                child.setAttr('visible', true);
            });
            stage_draggable.get('.' + clazz)[0].get('.company_logo_border').each(function(child, n) {
                child.setAttr('stroke', real_color);
                child.setAttr('visible', true);
            });
        }
        if (stage_average.get('.' + clazz)[0]) {
            stage_average.get('.' + clazz)[0].get('.company_logo_border').each(function(child, n) {
                child.setAttr('stroke', real_color);
                child.setAttr('visible', true);
            });
            stage_average.get('.' + clazz)[0].get('.company_logo_text').each(function(child, n) {
                child.setAttr('fill', real_color);
                child.setAttr('visible', true);
            });
        }

        if (stage_menu_on_right.get('.' + clazz)[0]) {
            stage_menu_on_right.get('.' + clazz)[0].get('.company_logo_border').each(function(child, n) {
                child.setAttr('stroke', real_color);
                child.setAttr('visible', true);
            });
            stage_menu_on_right.get('.' + clazz)[0].get('.company_logo_text').each(function(child, n) {
                child.setAttr('fill', real_color);
                child.setAttr('visible', true);
            });
        }


        stage_menu_on_right.batchDraw();
        stage_draggable.batchDraw();
        stage_average.batchDraw();
    }

    

    function _build_company_group(y, class_name, company_name, c_id, draggable, comp_color,stroke_width, bold) {
        var group = new Kinetic.Group({
            x: grid_width,
            y: y,
            draggable: draggable,
            id: c_id,
            real_color: comp_color,
            name: class_name,
        });

        var simpleText = new Kinetic.Text({
            x: 5,
            y: 30,
            text: company_name,
            fontSize: 12,
            fontFamily: 'Helvetica, Arial',
            fontStyle: bold,
            fill: comp_color,
            name: 'company_logo_text',
        });

        var border = new Kinetic.Rect({
            x: 0,
            y: 25,
            width: 95,
            height: 20,
            fill: "#fff",
            stroke: comp_color,
            strokeWidth: stroke_width,
            name: 'company_logo_border',
        });

        group.add(border);
        group.add(simpleText);

        group.on('mouseover', function() {
            document.body.style.cursor = 'pointer';
        });
        group.on('mouseout', function() {
            document.body.style.cursor = 'default';
        });
        return group;
    }

    // function build_background(layer, stage_width, stage_height) {
    //     var grid_background = new Kinetic.Rect({
    //         x: 0,
    //         y: 100,
    //         width: total_width,
    //         height: total_height
    //     });

    //     layer_background.add(grid_background);

    //     var grid_background = new Kinetic.Rect({
    //         x: grid_width,
    //         y: 0,
    //         width: total_width - grid_width,
    //         height: total_height
    //     });

    //     layer_background.add(grid_background);
    // }

    stage = new Kinetic.Stage({
        container: 'container',
        width: total_width,
        height: total_height,
    });

    stage_average = new Kinetic.Stage ({
        container: 'averagecontainer',
        width: 600,
        height: total_height,
    });

    stage_draggable = new Kinetic.Stage ({
        container: 'userplacement',
        width: 600,
        height: total_height,
    });

    stage_menu_on_right = new Kinetic.Stage ({
        container: 'nondraggable',
        width: 600,
        height: total_height,
    });

    var layer = new Kinetic.Layer();
    var layer_background = new Kinetic.Layer();

    // yuck!
    //build_background(layer, stage.getWidth(), stage.getHeight());

    for(var row in company_options) {
        var c = build_company_group_draggable(row);
        companies.push(c);
        layer.add(c)

        var c = build_company_group_hoverable(row);
        layer_nondraggable.add(c);
    }

    stage_draggable.add(layer_background);
    stage_draggable.add(layer);
    stage_menu_on_right.add(layer_nondraggable);

console.log(jQuery.browser.mobile);
    </script>
 </body>
</html>
